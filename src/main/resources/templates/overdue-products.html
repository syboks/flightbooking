<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Overdue Products</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" th:href="@{/css/style5.css}" />
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
<div class="container">
    <h6>Product Payment Deadline Report</h6>
    <table id="overdueTable" class="table table-striped">
        <thead>
        <tr>
            <th>Booking ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <!--            <th>Package</th>-->
            <th>Product Name</th>
            <th>Budget</th>
            <th>Payment Deadline</th>
            <th>Actual</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${overdueProducts}">
            <td th:text="${product.bookingId}"></td>
            <td th:text="${product.firstName}"></td>
            <td th:text="${product.lastName}"></td>
            <!--            <td th:text="${product.packageName}"></td>-->
            <td th:text="${product.productName}"></td>
            <!--            <td th:text="${#numbers.formatCurrency(product.price)}"></td>-->
            <!--            <td th:text="${product.formattedPrice}"></td>-->
            <td th:text="${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}"></td>
            <!--            <td th:text="${#numbers.currencyFormat(yourNumber, 'ZAR', 'en', 'ZA')}"></td>-->
            <td th:text="${product.paymentDeadlineDate}"></td>
            <!--            <td th:text="${#dates.format(product.paymentDeadlineDate,  'dd-MM-yyyy')}"></td>-->
            <td th:text="${product.actual}"></td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <th colspan="4">Total</th>
            <th id="totalPrice"></th> <!-- Placeholder for the total -->
            <th colspan="2"></th>
        </tr>
        </tfoot>
    </table>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>


<script>
    $(document).ready(function() {
        var table = $('#overdueTable').DataTable({
            "paging": true,
            "searching": false,
            "ordering": true,
            "info": true,
            "lengthChange": false,
            "pageLength": 25,
            "dom": 'Bfrtip',
            "buttons": [
                'excel', 'pdf', 'print'
            ],
            "footerCallback": function (row, data, start, end, display) {
                var api = this.api();

                // Helper function to clean and convert the price values
                var intVal = function (i) {
                    if (typeof i === 'string') {
                        // Remove any non-numeric characters except for periods or minus signs
                        i = i.replace(/R|\s|&nbsp;|,/g, '');

                    }
                    return i ? parseFloat(i) : 0; // Return parsed float or 0 if invalid
                };

                // Sum total over all pages
                var total = api
                    .column(4, { filter: 'applied' }) // Adjust index if necessary
                    .data()
                    .reduce(function (a, b) {
                        console.log("Current value:", a, b);
                        return intVal(a) + intVal(b);
                    }, 0);

                // Update the footer with correctly formatted total
                $('#totalPrice').html(new Intl.NumberFormat('en-ZA', { style: 'currency', currency: 'ZAR' }).format(total));
            }
        });
    });
</script>



</body>
</html>
